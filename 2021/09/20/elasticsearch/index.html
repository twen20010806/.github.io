<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>elasticsearch学习 | _raio</title><meta name="keywords" content="elastcisearch"><meta name="author" content="twen"><meta name="copyright" content="twen"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="elasticsearch搜索引擎用于站内搜索">
<meta property="og:type" content="article">
<meta property="og:title" content="elasticsearch学习">
<meta property="og:url" content="https://twen20010806.github.io/2021/09/20/elasticsearch/index.html">
<meta property="og:site_name" content="_raio">
<meta property="og:description" content="elasticsearch搜索引擎用于站内搜索">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://twen-img-host.oss-cn-beijing.aliyuncs.com/img/elasticsearch/cover.jpg">
<meta property="article:published_time" content="2021-09-19T16:00:00.000Z">
<meta property="article:modified_time" content="2021-09-26T08:24:39.918Z">
<meta property="article:author" content="twen">
<meta property="article:tag" content="elastcisearch">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://twen-img-host.oss-cn-beijing.aliyuncs.com/img/elasticsearch/cover.jpg"><link rel="shortcut icon" href="/img/server.jpg"><link rel="canonical" href="https://twen20010806.github.io/2021/09/20/elasticsearch/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: true,
    post: true
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2021-09-26 16:24:39'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    })(window)</script><meta name="generator" content="Hexo 5.4.0"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="author-avatar"><img class="avatar-img" src="/img/server.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">文章</div><div class="length-num">26</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">标签</div><div class="length-num">43</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">分类</div><div class="length-num">15</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 清单</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/%E9%9F%B3%E4%B9%90"><i class="fa-fw /music/"></i><span> 0</span></a></li><li><a class="site-page child" href="/%E7%94%B5%E5%BD%B1"><i class="fa-fw /movies/"></i><span> 1</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于我</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://twen-img-host.oss-cn-beijing.aliyuncs.com/img/elasticsearch/top_img.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">_raio</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 清单</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/%E9%9F%B3%E4%B9%90"><i class="fa-fw /music/"></i><span> 0</span></a></li><li><a class="site-page child" href="/%E7%94%B5%E5%BD%B1"><i class="fa-fw /movies/"></i><span> 1</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于我</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">elasticsearch学习</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2021-09-19T16:00:00.000Z" title="发表于 2021-09-20 00:00:00">2021-09-20</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2021-09-26T08:24:39.918Z" title="更新于 2021-09-26 16:24:39">2021-09-26</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/middleware/">middleware</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">5.3k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>22分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="elasticsearch学习"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="ElasticSearch"><a href="#ElasticSearch" class="headerlink" title="ElasticSearch"></a>ElasticSearch</h1><h2 id="Restful"><a href="#Restful" class="headerlink" title="Restful"></a>Restful</h2><ul>
<li>Rest:表现层状态转化(Representation State Transfer),如果一个架构符合REST原则,就称它为RESTful的<strong>软件架构风格</strong></li>
</ul>
<blockquote>
<p>REST是一组设计原则、设计约定、设计思路</p>
<p><strong>资源的表现层状态转化</strong></p>
</blockquote>
<ul>
<li><p>资源(Resource):网络中的一切事务称为资源,一首歌,一张图片,静态页面,数据库记录….。<strong>每一个资源都存在一个唯一的资源标识符-&gt;URL</strong></p>
</li>
<li><p>表现层(Representation):将资源具体呈现出来的形式称之为表现层</p>
</li>
<li><p>状态转化(State Transfer):客户端通过操作服务器中资源,使资源发生某种状态转变</p>
</li>
<li><p>原则:</p>
<ol>
<li><p>使用Rest的URL替换传统URL</p>
<ol>
<li>传统queryURL:<a target="_blank" rel="noopener" href="http://localhost:8080/projectname/findOne?id=21">http://localhost:8080/projectname/findOne?id=21</a></li>
<li>RestfulURL:<a target="_blank" rel="noopener" href="http://localhost:8080/projectname/findOne/21">http://localhost:8080/projectname/findOne/21</a></li>
</ol>
</li>
<li><p>四种动词对应服务端四种操作(CRUD)</p>
<ol>
<li>GET 获取</li>
<li>POST 创建或更新</li>
<li>PUT更新或创建</li>
<li>DELETE 删除</li>
</ol>
<blockquote>
<p>浏览器还不支持PUT DELETE动词,需要编码进行修改请求方式</p>
</blockquote>
</li>
</ol>
</li>
</ul>
<h2 id="全文检索"><a href="#全文检索" class="headerlink" title="全文检索"></a>全文检索</h2><p>​    <code>全文检索使计算机程序通过扫描文章中的每一个词,对每一个词建议一个索引,指明该词在文章中出现的次数和位置。当用户查询时根据建立的索引查找,类似于通过字典的检索子表查字的过程。</code></p>
<p>​    检索:索(建立索引) 检:(检查索引)</p>
<p>​    全文检索(FUll-Text Retrieval(检索)) 以文本作为检索对象,找出含有指定词汇的文本。<code>全面、准确和快速和衡量全文检索系统的关键指标。</code></p>
<p>​    关于全文检索,我们要知道:</p>
<ol>
<li>只处理文本。</li>
<li>不处理语义</li>
<li>检索时英文不区分大小写</li>
<li>结果列表有相关度排序</li>
</ol>
<h2 id="什么是ElasticSearch"><a href="#什么是ElasticSearch" class="headerlink" title="什么是ElasticSearch"></a>什么是ElasticSearch</h2><p>​    <code>ElasticSearch</code>简称ES,<code>是基于Apach Lucene构建的开源搜索引擎,是当前流行的企业级搜索引擎。</code>Lucene本身就可以被认为迄今为止性能最好的一款开源搜素工具包,但是Lucene的API相对复杂,需要深厚的搜索理论。很难集成到实际的应用中。<code>但是ES是采用java语言编写,提供了简单易用的RestFul API,开发者可以使用简单的RestFul API、开发相关的搜索功能,从而避免luncne的复杂性。</code></p>
<h2 id="Elastic-Stack-栈"><a href="#Elastic-Stack-栈" class="headerlink" title="Elastic Stack 栈"></a>Elastic Stack 栈</h2><p>Beats + EalstciSearch + Kibana + logstash</p>
<h2 id="ES的应用场景"><a href="#ES的应用场景" class="headerlink" title="ES的应用场景"></a>ES的应用场景</h2><p>​    <code>ES主要以轻量级JSON作为数据存储格式,这点与MongoDB有点类似,但它在读写性能上由于MongoDB。同时也支持地理位置查询,还方便地理位置和文本混合查询。以及在统计、日志类数据存储和分析、可视化这方面是引领者</code></p>
<h2 id="ES的架构"><a href="#ES的架构" class="headerlink" title="ES的架构"></a>ES的架构</h2><p><img src="https://twen-img-host.oss-cn-beijing.aliyuncs.com/img/elasticsearch/image-20210913085143014.png" alt="image-20210913085143014"></p>
<p><code>Elastic服务在开启后默认不允许远程访问</code></p>
<h1 id="ElasticSearch安装"><a href="#ElasticSearch安装" class="headerlink" title="ElasticSearch安装"></a>ElasticSearch安装</h1><h2 id="使用Docker安装ES-6-8-0"><a href="#使用Docker安装ES-6-8-0" class="headerlink" title="使用Docker安装ES 6.8.0"></a>使用Docker安装ES 6.8.0</h2><blockquote>
<p>拉取镜像</p>
</blockquote>
<p><code>docekr pull elasticsearch:6.8.0</code></p>
<blockquote>
<p>使用镜像</p>
</blockquote>
<p><code>docker run -d -p 9200:9200 -p 9300:9300 -e &quot;discovery.type=single-node&quot; elasticsearch:6.8.0</code></p>
<blockquote>
<p>外部访问9200是kibana端口,9300是web访问端口</p>
</blockquote>
<p><img src="https://twen-img-host.oss-cn-beijing.aliyuncs.com/img/elasticsearch/image-20210913085642123.png" alt="image-20210913085642123"></p>
<h2 id="开启ES远程连接权限"><a href="#开启ES远程连接权限" class="headerlink" title="开启ES远程连接权限"></a>开启ES远程连接权限</h2><blockquote>
<p>修改es配置文件elasticsearch.yml的network.host为0.0.0.0</p>
</blockquote>
<p><img src="https://twen-img-host.oss-cn-beijing.aliyuncs.com/img/elasticsearch/image-20210913085947139.png" alt="image-20210913085947139"></p>
<blockquote>
<p>修改虚拟机系统配置</p>
</blockquote>
<p><code>vim /etc/security/limitis.conf</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">*	soft nofile 65536</span><br><span class="line">*	hard nofile 65536</span><br><span class="line">*	soft nproc 4096</span><br><span class="line">*	hard nproc 4096</span><br></pre></td></tr></table></figure>

<p><code>查看配置修改是否生效</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">ulimit</span> -Hn</span><br><span class="line"><span class="built_in">ulimit</span> -Sn</span><br><span class="line"><span class="built_in">ulimit</span> -Hu</span><br><span class="line">Ulimit -Su</span><br></pre></td></tr></table></figure>

<blockquote>
<p>修改启动ES的用户名</p>
</blockquote>
<p><code>vim /etc/security/limits.d/20-nproc.conf</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">username	soft nproc 4096</span><br></pre></td></tr></table></figure>

<blockquote>
<p>修改最大线程数</p>
</blockquote>
<p><code> vim /etc/systcl.conf</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vm.max-map_count&#x3D;655360</span><br></pre></td></tr></table></figure>

<h2 id="Kibana安装"><a href="#Kibana安装" class="headerlink" title="Kibana安装"></a>Kibana安装</h2><p><code>Kibana需要与ES版本一致</code></p>
<blockquote>
<p>Kibana镜像拉取</p>
</blockquote>
<p><code>docker pull kibana:tag</code></p>
<blockquote>
<p>Kibana启动</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -e --name kibana </span><br></pre></td></tr></table></figure>

<blockquote>
<p>需要与elasticsearch同一个服务器</p>
</blockquote>
<p><code>kibana/yml</code></p>
<p><img src="https://twen-img-host.oss-cn-beijing.aliyuncs.com/img/elasticsearch/image-20210913142027576.png" alt="image-20210913142027576"></p>
<p><img src="https://twen-img-host.oss-cn-beijing.aliyuncs.com/img/elasticsearch/image-20210913142705032.png" alt="image-20210913142705032"></p>
<h1 id="ElasticSearch基本概念"><a href="#ElasticSearch基本概念" class="headerlink" title="ElasticSearch基本概念"></a>ElasticSearch基本概念</h1><h2 id="接近实时-NRT-Near-Real-Time"><a href="#接近实时-NRT-Near-Real-Time" class="headerlink" title="接近实时(NRT Near Real Time)"></a>接近实时(NRT Near Real Time)</h2><p>​    <code>Elasticsearch是一个接近实时的搜索平台</code>,这意味着,<code>从索引一个文档直到这个文档都能够搜索到有一个轻微的延迟(通常是1秒内)</code></p>
<p>​    索引数据Beats—-&gt;ES服务—-&gt;搜索</p>
<h2 id="索引-index"><a href="#索引-index" class="headerlink" title="索引(index)"></a>索引(index)</h2><p>​    <code>一个索引就是一个拥有积分相似特征的文档的集合</code>。比如说,你可以有一个客户数据的索引,另一个产品目录的索引,还有一个订单数据的索引。<code>一个索引由一个名字来标识(必须全部是小写字母),并且当我们要对这个索引中的文档进行索引、搜索、更新和删除的时候,都要使用到这个名字。索引类似于关系型数据库中Database的概念。</code>在一个集群中,如果你想,可以定义任意多的索引。</p>
<h2 id="类型-type"><a href="#类型-type" class="headerlink" title="类型(type)"></a>类型(type)</h2><p>​    <code>在一个索引中,你可以定义一种或多种类型。</code>一个类型是你的索引的一个逻辑上的分类/分区,其语义完全由你来定。通常,会为具有一组共同字段的文档定义一次类型。比如说,假设一个博客平台并且将你所有的数据存储到一个索引中。在这个索引中,可以为用户数据定义一个类型，为博客数据定义另一个类型。当然,也可以为评论数据定义为另一个类型。<code>类型类似于关系数据库中Table的概念。</code></p>
<p>​    <code>NOTE:在5.x版本以前可以在一个索引中定义多个类型,6.x之后版本也可以使用,但不推荐,在7~8.x版本中彻底移除一个索引中创建多个类型</code></p>
<h2 id="映射-Mapping"><a href="#映射-Mapping" class="headerlink" title="映射(Mapping)"></a>映射(Mapping)</h2><p>​    <code>Mapping</code>是ES中一个很重要的内容,<code>它类似于传统关系型数据库中table的schema(约束),用于定义一个索引(index)中的类型的数据结构</code></p>
<h2 id="文档-documnt"><a href="#文档-documnt" class="headerlink" title="文档(documnt)"></a>文档(documnt)</h2><p>​    <code>一个文档是一个可被索引的基础信息单元,类似于表中的一条记录</code>比如,你可以拥有某一个员工的文档,也可以拥有某个商品的一个文档,文档以采用的轻量级的数据交换格式JSON来表示。</p>
<h1 id="Kibana的基本操作"><a href="#Kibana的基本操作" class="headerlink" title="Kibana的基本操作"></a>Kibana的基本操作</h1><h2 id="索引-index-的基本操作"><a href="#索引-index-的基本操作" class="headerlink" title="索引(index)的基本操作"></a>索引(index)的基本操作</h2><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">PUT /dangdang  			创建索引</span><br><span class="line">DELETE /DANGDANG 		删除</span><br><span class="line">DELETE /* 				删除所有索引</span><br><span class="line">GET /_cat/indices?v 	查看索引信息</span><br></pre></td></tr></table></figure>

<blockquote>
<p>查看所有索引</p>
</blockquote>
<p><img src="https://twen-img-host.oss-cn-beijing.aliyuncs.com/img/elasticsearch/image-20210913144338513.png" alt="image-20210913144338513"></p>
<p>health:节点健康状态</p>
<ul>
<li>yellow:索引可用不健壮</li>
<li>green:索引健壮</li>
<li>red:索引不可用</li>
</ul>
<blockquote>
<p>类型操作 index/type(mapping) 一个索引只能存在一个mapping</p>
</blockquote>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span><span class="string">.</span> <span class="string">创建/dangdang索引并创建(product类型)</span></span><br><span class="line"><span class="string">PUT</span> <span class="string">/dangdang</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;mappings&quot;</span><span class="string">:</span>&#123;<span class="string">//固定写死</span></span><br><span class="line">    <span class="string">&quot;product&quot;</span><span class="string">:</span>&#123;</span><br><span class="line">      <span class="string">&quot;properties&quot;</span><span class="string">:</span>&#123;<span class="string">//代表下面的都是该对象的属性</span></span><br><span class="line">        <span class="attr">&quot;title&quot;:</span>	&#123;<span class="string">&quot;type&quot;</span><span class="string">:&quot;text&quot;</span>&#125;,</span><br><span class="line">        <span class="attr">&quot;name&quot;:</span>     &#123;<span class="string">&quot;type&quot;</span><span class="string">:&quot;text&quot;</span>&#125;,</span><br><span class="line">        <span class="attr">&quot;age&quot;:</span>      &#123;<span class="string">&quot;type&quot;</span><span class="string">:&quot;integer&quot;</span>&#125;,</span><br><span class="line">        <span class="attr">&quot;created&quot;:</span>  &#123;</span><br><span class="line">        	<span class="attr">&quot;type&quot;:</span>  <span class="string">&quot;date&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Mapping Type: text,keyword,date,integer,long,double,boolean or ip</p>
</blockquote>
<blockquote>
<p>查看单个索引,可以查看mappings</p>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /dangdang</span><br></pre></td></tr></table></figure>

<blockquote>
<p>查看索引下的mapping</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /dangdang/_mapping</span><br></pre></td></tr></table></figure>

<blockquote>
<p>文档操作:插入一条文档 PUT /索引/类型/id(elasticsearch自动添加的_id)</p>
</blockquote>
<blockquote>
<p>文档相关操作:添加文档  删除  修该  查询</p>
</blockquote>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">PUT</span> <span class="string">/index/mapping/_id</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="string">&quot;key&quot;</span><span class="string">:&quot;value&quot;</span>,</span><br><span class="line">	<span class="string">&quot;key&quot;</span><span class="string">:&quot;value&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="string">POST</span> <span class="string">/index/mapping&#123;</span></span><br><span class="line">	<span class="string">&quot;key&quot;</span><span class="string">:&quot;value&quot;,</span></span><br><span class="line">	<span class="string">&quot;key&quot;</span><span class="string">:&quot;value&quot;</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure>

<p><code>如果需要系统自动生成id,需要使用POST方式请求</code></p>
<blockquote>
<p>获取document</p>
</blockquote>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">GET</span> <span class="string">/index/mapping/_id</span></span><br></pre></td></tr></table></figure>

<p><img src="https://twen-img-host.oss-cn-beijing.aliyuncs.com/img/elasticsearch/image-20210913161605228.png" alt="image-20210913161605228"></p>
<p>查询所有的document</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">GET /employee/emp/_search\?pretty</span><br><span class="line">&#123;</span><br><span class="line">	&quot;query&quot;:&#123;</span><br><span class="line">		&quot;match_all&quot;:&#123;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<blockquote>
<p>更新数据</p>
</blockquote>
<ol>
<li>POST:此方式会将原来的对象删除之后创建一个新的对象</li>
</ol>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">POST /index/mapping/_id&#123;</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>POST{“doc”}:使用此种方式更新会将原始数据查询之后使用doc里面的数据进行更新</li>
</ol>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">POST /index/mapping/_id&#123;</span><br><span class="line">	&quot;doc&quot;:&#123;</span><br><span class="line">		......</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>NOTE:在使用此种方式进行更新时如果添加了mapping里面没有的字段es会根据参数自动进行推断(不够准确)</code></p>
<ol start="3">
<li>基于scirpt方式的更新(了解)</li>
</ol>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">POST /index/mapping/_id/_update</span><br><span class="line">&#123;</span><br><span class="line">	&quot;script&quot;: &quot;ctx._source.key+=3&quot;//context为上下文对象可以使用source获取对象,再通过.获取具体的属性</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>文档批量操作</li>
</ol>
<blockquote>
<p>使用_bulk(批量操作) 添加(index) 删除(delete) 更新(update)</p>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">PUT /index/mapping/_bulk</span><br><span class="line">&#123;&quot;index&quot;:&#123;&#125;&#125;//如果这里的&#123;&#125;为空,那么为es会为我们自动添加一个_id</span><br><span class="line">  &#123;&quot;key&quot;:&quot;value&quot;,&quot;key&quot;:&quot;value&quot;&#125;</span><br><span class="line">&#123;&quot;index&quot;:&#123;&quot;_id&quot;:&quot;4&quot;&#125;&#125;//如果这里添加了_id字段,则根据自定义的id字段来添加</span><br><span class="line">  &#123;&quot;key&quot;:&quot;value&quot;,&quot;key&quot;:&quot;value&quot;&#125;</span><br><span class="line">&#123;&quot;delete&quot;:&#123;&quot;_id&quot;:&quot;1&quot;&#125;&#125;//删除</span><br><span class="line">&#123;&quot;update&quot;:&#123;&quot;_id&quot;:&quot;2&quot;&#125;&#125;</span><br><span class="line">	&#123;&quot;doc&quot;:&quot;&#123;&quot;key&quot;:&quot;value&quot;&#125;&quot;&#125;</span><br></pre></td></tr></table></figure>

<p>批量操作非事务,不具有原子性。</p>
<h1 id="ES中高级搜索-Query"><a href="#ES中高级搜索-Query" class="headerlink" title="ES中高级搜索(Query)"></a>ES中高级搜索(Query)</h1><h2 id="检索方式"><a href="#检索方式" class="headerlink" title="检索方式"></a>检索方式</h2><p>​    ES官方提供了两种检索方式:<code>一种是通过URL参数进行搜索,另一种是通过DSL(Domain Specified Language)进行搜索。官方更推荐使用第二种方式是基于传递JSON作为请求体(request body)格式与ES进行交互,这种方式更强大更简洁。</code></p>
<ul>
<li><p>使用语法</p>
<p>URL查询:GET /index/mapping/_search?参数</p>
<p>DSL查询:GET /index/mapping/_search{}</p>
</li>
<li><p>参数设计</p>
</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">PUT /ems</span><br><span class="line">&#123;</span><br><span class="line">  &quot;mappings&quot;: &#123;</span><br><span class="line">    &quot;emp&quot;:&#123;</span><br><span class="line">      &quot;properties&quot;:&#123;</span><br><span class="line">        &quot;name&quot;:&#123;&quot;type&quot;:&quot;text&quot;&#125;,</span><br><span class="line">        &quot;age&quot;:&#123;&quot;type&quot;:&quot;integer&quot;&#125;,</span><br><span class="line">        &quot;bir&quot;:&#123;&quot;type&quot;:&quot;date&quot;&#125;,</span><br><span class="line">        &quot;content&quot;:&#123;&quot;type&quot;:&quot;text&quot;&#125;,</span><br><span class="line">        &quot;address&quot;:&#123;&quot;type&quot;:&quot;keyword&quot;&#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="基于QueryString方式的检索"><a href="#基于QueryString方式的检索" class="headerlink" title="基于QueryString方式的检索"></a>基于QueryString方式的检索</h2><p>GET  /index/mapping/_search?q</p>
<blockquote>
<p>查询所有的document:散列</p>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /index/mapping/_search?q=*</span><br></pre></td></tr></table></figure>

<blockquote>
<p>查询所有的document并按照一定条件排序</p>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">//升序排序</span><br><span class="line">GET /index/mapping/_search?q=*&amp;sort=age</span><br><span class="line">//降序排序</span><br><span class="line">GET /index/mapping/_search?q=*&amp;sort=age:desc</span><br></pre></td></tr></table></figure>

<blockquote>
<p>分页</p>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">//限制查询</span><br><span class="line">GET /index/mapping/_search?q=*&amp;sort=age&amp;size=2</span><br><span class="line">//分页</span><br><span class="line">GET /index/mapping/_search?q=*&amp;sort=age&amp;size=2&amp;from=0</span><br></pre></td></tr></table></figure>

<blockquote>
<p>指定返回哪些字段</p>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /index/mapping/_search?q=*&amp;_source=name,age</span><br></pre></td></tr></table></figure>

<h2 id="基于QueryDSL方式的检索"><a href="#基于QueryDSL方式的检索" class="headerlink" title="基于QueryDSL方式的检索"></a>基于QueryDSL方式的检索</h2><blockquote>
<p>查看所有的document</p>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">GET /index/mapping/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;:&#123;</span><br><span class="line">    &quot;match_all&quot;:&#123;&#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>查看所有的document并排序</p>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">GET /ems/emp_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;:&#123;</span><br><span class="line">  	&quot;match_all&quot;:&#123;&#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;sort&quot;:[</span><br><span class="line">  	&#123;</span><br><span class="line">  	  &quot;FIELD&quot;:&#123;</span><br><span class="line">  	    &quot;order&quot;:&quot;desc&quot;</span><br><span class="line">  	  &#125;</span><br><span class="line">  	&#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">GET /ems/emp/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;:&#123;</span><br><span class="line">    &quot;match_all&quot;: &#123;&#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;sort&quot;:[</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;age&quot;:&#123;</span><br><span class="line">        &quot;order&quot;:&quot;desc&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>NOTE:text不支持排序,因为text要进行分词</code></p>
<blockquote>
<p>查询结果中返回指定条数(Size) 默认10,分页</p>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">GET /index/mapping/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;:&#123;</span><br><span class="line">  	&quot;match_all&quot;:&#123;&#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;size&quot;:&quot;1&quot;，</span><br><span class="line">  &quot;from&quot;:&quot;0&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>查询结果返回指定字_source</p>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">GET /index/mapping/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;:&#123;</span><br><span class="line">	&quot;match_all&quot;:&#123;&#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;size&quot;:&quot;1&quot;.</span><br><span class="line">  &quot;from&quot;:&quot;0&quot;,</span><br><span class="line">  &quot;_source&quot;:&quot;name&quot; or &quot;_source&quot;:[&quot;name&quot;,&quot;age&quot;]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>关键词查询term</p>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">GET /index/mapping/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;:&#123;</span><br><span class="line"> 	&quot;term&quot;:&#123;</span><br><span class="line"> 	  &quot;content&quot;:&#123;//documentkey</span><br><span class="line"> 	    &quot;value&quot;:&quot;spring&quot;</span><br><span class="line"> 	  &#125;</span><br><span class="line"> 	&#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注意：</p>
<ol>
<li>只有type:text 类型分词 剩下的类型都不分词</li>
<li>ES中默认使用的分词器是标准分词器 standardAnalyzer,对于中文是单字分词,对英文是单词分词</li>
</ol>
<blockquote>
<p>范围查询(range):用来指定查询指定范围内得文档</p>
<p>gte:greater than &amp; equal    gt:greater than</p>
<p>lte:less than $ equal           lt:less than</p>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">GET /index/mapping/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;:&#123;</span><br><span class="line"> 	&quot;range&quot;:&#123;</span><br><span class="line">      &quot;age&quot;:&#123;</span><br><span class="line">        &quot;gte&quot;: 10,</span><br><span class="line">        &quot;lte&quot;: 20</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;	</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>前缀查询prefix</p>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">GET /index/mapping/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;:&#123;</span><br><span class="line">    &quot;prefix&quot;:&#123;</span><br><span class="line">      &quot;address&quot;:&#123;</span><br><span class="line">        &quot;value&quot;:&quot;北&quot;//查询以北为前缀的address</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>通配符查询 wildcard</p>
<p>?:匹配一个任意字符</p>
<p>*:匹配任意多少个字符0-n</p>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">GET /index/mapping/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;:&#123;</span><br><span class="line">    &quot;wildcard&quot;:&#123;</span><br><span class="line">      &quot;address&quot;:&#123;</span><br><span class="line">        &quot;value&quot;:&quot;北?&quot;//查询以北开头的第二个为任意字符的address</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>多id查询(ids)</p>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">GET /index/mapping/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;:&#123;</span><br><span class="line">     &quot;ids&quot;:&#123;</span><br><span class="line">       &quot;values&quot;:[&quot;id&quot;,&quot;id&quot;,&quot;id&quot;];</span><br><span class="line">     &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>模糊查询(fuzzy):</p>
<p>关键词在0-2之间:不允许模糊</p>
<p>关键词在3-5之间:允许一个模糊</p>
<p>关键词大于5:允许两个模糊</p>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">GET /index/mapping/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;:&#123;</span><br><span class="line">    &quot;furzzy&quot;:&#123;</span><br><span class="line">      &quot;address&quot;:&quot;北&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>布尔查询(bool)</p>
<p>bool关键字:用于组合多个条件实现复杂查询</p>
<p>must:相当于&amp;&amp;</p>
<p>should:相当于||</p>
<p>must_not:相当于!</p>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">GET /index/mapping/_search&#123;</span><br><span class="line">  &quot;query&quot;:&#123;</span><br><span class="line">    &quot;bool&quot;:&#123;</span><br><span class="line">      &quot;must&quot;:[</span><br><span class="line">        &#123;</span><br><span class="line">          &quot;term&quot;:&#123;</span><br><span class="line">            &quot;address&quot;:&#123;</span><br><span class="line">              &quot;value&quot;:&quot;北京&quot;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          &quot;term&quot;:&#123;</span><br><span class="line">       		&quot;age&quot;:&#123;</span><br><span class="line">       		  &quot;value&quot;:18</span><br><span class="line">       		&#125;</span><br><span class="line">      	   &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>高亮查询(highlight):搜索的关键词会被标上其他颜色</p>
<p>与query平级使用,结果不会改变元数据区的数据,而是会新增一条highlight记录</p>
<p>自定义高亮标签:可以在highlight中使用pre_tags和post_tags</p>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">GET /index/mapping/_search&#123;</span><br><span class="line">   &quot;query&quot;:&#123;</span><br><span class="line">     &quot;term&quot;:&#123;</span><br><span class="line">       &quot;content&quot;:&quot;框架&quot;</span><br><span class="line">     &#125;</span><br><span class="line">   &#125;，</span><br><span class="line">   “highlihgt&quot;:&#123;</span><br><span class="line">     &quot;pre_tags&quot;:[&quot;&lt;span style = &#x27;color:red&#x27;&gt;&quot;],</span><br><span class="line">     &quot;post_tags&quot;:[&quot;&lt;/span&gt;&quot;],</span><br><span class="line">     &quot;fields&quot;:&#123;</span><br><span class="line">       &quot;*&quot;:&#123;&#125;//表示匹配所有的字段(mapping里面的字段)</span><br><span class="line">     &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>多字段查询(multi_match) 搜索比较智能</p>
<ol>
<li>如果搜索字段分词,它会对query进行先分词再搜索</li>
<li>如果搜索字段不分词,会直接使用query整体进行搜索</li>
</ol>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">GET /index/mapping/_search&#123;</span><br><span class="line">  &quot;query&quot;:&#123;</span><br><span class="line">    &quot;multi_match&quot;:&#123;</span><br><span class="line">      &quot;query&quot;:&quot;北京Redis&quot;,</span><br><span class="line">      &quot;fiedls&quot;:[&quot;content&quot;,&quot;address&quot;]//content为text,可以分词。address为keyword,不能分词,直接匹配。</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>多字段分词查询(query_string)</p>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">GET /index/mapping/_search&#123;</span><br><span class="line">  &quot;query&quot;:&#123;</span><br><span class="line">    &quot;query_string&quot;:&#123;</span><br><span class="line">     &quot;query&quot;:&quot;redis&quot;,</span><br><span class="line">     &quot;fields&quot;:[&quot;name&quot;,content],</span><br><span class="line">     &quot;analyzer&quot;:&quot;ik_max_word&quot;//指定分词器</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>(过滤查询)Filter Query</p>
</blockquote>
<ol>
<li>过滤查询</li>
</ol>
<blockquote>
<p>​    准确来说,ES中的查询操作分为2种:<code>查询(query)</code>和<code>过滤(filter)</code>。<code>查询即是之前提到的query查询,它(查询)默认会计算每个返回文档的得分,然后根据得分排序。而过滤(filter)只会筛选出符合的文档,并不计算得分,且它可以缓存文档。所以但从性能考虑,过滤比查询快。</code></p>
<p>​    换句话说,过滤适合在大范围筛选数据,而查询则适合精确匹配数据。一般应用时,应先使用过滤操作过滤数据,然后使用查询匹配数据。</p>
</blockquote>
<ol start="2">
<li>过滤语法</li>
</ol>
<p>exsits用于过滤document中存在feild指定字段的document</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">GET /ems/emp/_search</span><br><span class="line">&#123;</span><br><span class="line">	&quot;query&quot;:&#123;</span><br><span class="line">	  &quot;bool&quot;:&#123;</span><br><span class="line">	    &quot;must&quot;:[&#123;&quot;match_all&quot;:&#123;&#125;&#125;]</span><br><span class="line">	  &#125;</span><br><span class="line">	&#125;,</span><br><span class="line">	&quot;filter&quot;:&#123;</span><br><span class="line">	  &quot;range&quot;:&#123;</span><br><span class="line">	    &quot;age&quot;:&#123;</span><br><span class="line">	      &quot;gte&quot;:10</span><br><span class="line">	    &#125;</span><br><span class="line">	  &#125;,</span><br><span class="line">	  &quot;exists&quot;:&#123;</span><br><span class="line">	    &quot;feild&quot;: &quot;name&quot; //此处指定name必须存在</span><br><span class="line">	  &#125;,</span><br><span class="line">	  &quot;ids&quot;:&#123;</span><br><span class="line">	    &quot;values&quot;:[&quot;id&quot;,&quot;id&quot;.&quot;id&quot;]</span><br><span class="line">	  &#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="索引底层原理分析"><a href="#索引底层原理分析" class="headerlink" title="索引底层原理分析"></a>索引底层原理分析</h2><blockquote>
<p>ES自身的数据结构包含索引区和元数据区,元数据区包含该对象的所有数据,索引区包含相关的索引</p>
</blockquote>
<p><img src="https://twen-img-host.oss-cn-beijing.aliyuncs.com/img/elasticsearch/image-20210914181030458.png" alt="image-20210914181030458"></p>
<h1 id="IK分词器"><a href="#IK分词器" class="headerlink" title="IK分词器"></a>IK分词器</h1><p>​    <code>NOTE:默认ES中采用标准分词器进行分词,这种方式并不适用于中文网站,因此需要修该ES对中文友好分词,从而达到更佳的搜索的效果。</code></p>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p>​    <code>NOTE:IK分词器版本一定要和ES版本一致</code></p>
<h2 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h2><p>IK分词器有两个分词模式</p>
<ol>
<li>ik_smart:智能分词</li>
<li>ik_max_word:穷举,最细粒度分词</li>
</ol>
<p><img src="https://twen-img-host.oss-cn-beijing.aliyuncs.com/img/elasticsearch/image-20210915114824740.png" alt="image-20210915114824740"></p>
<blockquote>
<p>测试数据    </p>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">PUT /ems</span><br><span class="line">&#123;</span><br><span class="line">  &quot;mappings&quot;: &#123;</span><br><span class="line">    &quot;emp&quot;:&#123;</span><br><span class="line">      &quot;properties&quot;:&#123;</span><br><span class="line">        &quot;name&quot;:&#123;</span><br><span class="line">          &quot;type&quot;:&quot;text&quot;,</span><br><span class="line">          &quot;analyzer&quot;:&quot;ik_max_word&quot;,</span><br><span class="line">          &quot;search_analyzer&quot;:&quot;ik_max_word&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;age&quot;:&#123;</span><br><span class="line">          &quot;type&quot;:&quot;integer&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;bir&quot;:&#123;</span><br><span class="line">          &quot;type&quot;:&quot;date&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;content&quot;:&#123;</span><br><span class="line">          &quot;type&quot;:&quot;text&quot;,</span><br><span class="line">          &quot;analyzer&quot;:&quot;ik_max_word&quot;,</span><br><span class="line">          &quot;search_analyzer&quot;:&quot;ik_max_word&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;address&quot;:&#123;</span><br><span class="line">          &quot;type&quot;:&quot;keyword&quot;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>​    <code>analyzer与search_analyzer应该相同,且当指定了analyzer时,search_analyzer会与其相同</code></p>
<ul>
<li><p>在创建索引，指定analyzer，ES在创建时会先检查是否设置了analyzer字段，如果没定义就用ES预设的</p>
</li>
<li><p>在查询时，指定search_analyzer，ES查询时会先检查是否设置了search_analyzer字段，如果没有设置，还会去检查创建索引时是否指定了analyzer，还是没有还设置才会去使用ES预设的</p>
</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">PUT /ems/emp/_bulk</span><br><span class="line">&#123;&quot;index&quot;:&#123;&#125;&#125;</span><br><span class="line">&#123;&quot;name&quot;:&quot;小黑&quot;,&quot;age&quot;:23,&quot;bir&quot;:&quot;2012-02-23&quot;,&quot;content&quot;:&quot;我是一只猫,快乐的星猫,周围冒气泡,快乐的符号&quot;,&quot;address&quot;:&quot;北京&quot;&#125;</span><br><span class="line">&#123;&quot;index&quot;:&#123;&#125;&#125;</span><br><span class="line">&#123;&quot;name&quot;:&quot;小白&quot;,&quot;age&quot;:21,&quot;bir&quot;:&quot;2010-04-23&quot;,&quot;content&quot;:&quot;别看我小,别看我小,我小的让你找不到&quot;,&quot;address&quot;:&quot;白京&quot;&#125;</span><br><span class="line">&#123;&quot;index&quot;:&#123;&#125;&#125;</span><br><span class="line">&#123;&quot;name&quot;:&quot;小魔&quot;,&quot;age&quot;:23,&quot;bir&quot;:&quot;2008-05-23&quot;,&quot;content&quot;:&quot;兽人永不为奴&quot;,&quot;address&quot;:&quot;部落&quot;&#125;</span><br><span class="line">&#123;&quot;index&quot;:&#123;&#125;&#125;</span><br><span class="line">&#123;&quot;name&quot;:&quot;小联&quot;,&quot;age&quot;:26,&quot;bir&quot;:&quot;2011-02-23&quot;,&quot;content&quot;:&quot;为了联盟&quot;,&quot;address&quot;:&quot;联盟&quot;&#125;</span><br><span class="line">&#123;&quot;index&quot;:&#123;&#125;&#125;</span><br><span class="line">&#123;&quot;name&quot;:&quot;小艾&quot;,&quot;age&quot;:23,&quot;bir&quot;:&quot;2012-02-23&quot;,&quot;content&quot;:&quot;原水晶指引你&quot;,&quot;address&quot;:&quot;艾欧泽亚&quot;&#125;</span><br><span class="line">&#123;&quot;index&quot;:&#123;&#125;&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>配置IK扩展</p>
</blockquote>
<p>​    <code>为什么要配置扩展:ES无法及时获取网络热词(扩展词)</code></p>
<p>如何配置?</p>
<p>进入IK分词器中的config文件下的IKAnalyzer.cfg.xml进行配置</p>
<p><img src="https://twen-img-host.oss-cn-beijing.aliyuncs.com/img/elasticsearch/image-20210915180302383.png" alt="image-20210915180302383"></p>
<p>扩展词典:扩展的词典</p>
<p>停用词典:停止进行分词的词典</p>
<p><code>搭建步骤</code></p>
<ol>
<li>编写一个文件里面拥有扩展词,一行只能有一个词。</li>
<li>在IKAnalyzer里面的ext_dict或者ext_stopwords里面写上编写的文件名</li>
</ol>
<p><img src="https://twen-img-host.oss-cn-beijing.aliyuncs.com/img/elasticsearch/image-20210915181222180.png" alt="image-20210915181222180"></p>
<p><code>NOTE:扩展词只能给新增文档分词,对于以前的文档不能生效</code></p>
<blockquote>
<p>配置远程词典 </p>
</blockquote>
<h1 id="JAVA操作ES"><a href="#JAVA操作ES" class="headerlink" title="JAVA操作ES"></a>JAVA操作ES</h1><h2 id="引入maven依赖"><a href="#引入maven依赖" class="headerlink" title="引入maven依赖"></a>引入maven依赖</h2><p><code>与elasticsearch版本一致</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.elasticsearch<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>elasticsearch<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>6.8.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.elasticsearch.client<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>transport<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>6.8.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.elasticsearch.plugin<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>transport-netty4-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>6.8.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="springboot-集成-ES"><a href="#springboot-集成-ES" class="headerlink" title="springboot 集成 ES"></a>springboot 集成 ES</h1><p><code>引入springboot-starter-elasticsearch</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-elasticsearch<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>需要加入spring web依赖不然会报错httpHeaders找不到</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="新版使用RestHighLevelClient"><a href="#新版使用RestHighLevelClient" class="headerlink" title="新版使用RestHighLevelClient"></a>新版使用RestHighLevelClient</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RestClientConfig</span> <span class="keyword">extends</span> <span class="title">AbstractElasticsearchConfiguration</span> </span>&#123;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="meta">@Bean</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> RestHighLevelClient <span class="title">elasticsearchClient</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> ClientConfiguration clientConfiguration = ClientConfiguration.builder()</span><br><span class="line">      .connectedTo(<span class="string">&quot;192.168.200.130:9200&quot;</span>)</span><br><span class="line">      .build();</span><br><span class="line">    <span class="keyword">return</span> RestClients.create(clientConfiguration).rest();</span><br><span class="line">  &#125;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<h2 id="面向对象特性的操作ES的api"><a href="#面向对象特性的操作ES的api" class="headerlink" title="面向对象特性的操作ES的api"></a>面向对象特性的操作ES的api</h2><p><code>ElasticSearchRepository接口面向对象,提供系列CRUD的方法,此接口只提供了简单的ESapi,如果需要复杂查询使用RestHighLevelCLient</code></p>
<h2 id="删除"><a href="#删除" class="headerlink" title="删除"></a>删除</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> RestHighLevelClient restHighLevelClient;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">  DeleteRequest deleteRequest = <span class="keyword">new</span> DeleteRequest(<span class="string">&quot;ems&quot;</span>,<span class="string">&quot;_eMi6HsBmav3KFW-tgs5&quot;</span>);</span><br><span class="line">  DeleteResponse delete = restHighLevelClient.delete(deleteRequest, RequestOptions.DEFAULT);</span><br><span class="line">  System.out.println(delete.status());</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="创建entity"><a href="#创建entity" class="headerlink" title="创建entity"></a>创建entity</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="comment">//使用document在es中创建索引,要求此索引之前不能存在,</span></span><br><span class="line"><span class="meta">@Document(indexName = &quot;ems&quot;,type = &quot;emp&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Emp</span> </span>&#123;</span><br><span class="line">  <span class="meta">@Id</span><span class="comment">//将entity中的id与_id对应</span></span><br><span class="line">  <span class="keyword">private</span> String id;</span><br><span class="line">  <span class="meta">@Field(type = FieldType.Text,analyzer = &quot;ik_max_word&quot;)</span></span><br><span class="line">  <span class="keyword">private</span> String name;</span><br><span class="line">  <span class="meta">@Field(type = FieldType.Integer)</span></span><br><span class="line">  <span class="keyword">private</span> Integer age;</span><br><span class="line">  <span class="meta">@Field(type = FieldType.Date)</span></span><br><span class="line">  <span class="keyword">private</span> Date bir;</span><br><span class="line">  <span class="meta">@Field(type = FieldType.Text,analyzer = &quot;ik_max_word&quot;)</span></span><br><span class="line">  <span class="keyword">private</span> String content;</span><br><span class="line">  <span class="meta">@Field(type = FieldType.Keyword)</span></span><br><span class="line">  <span class="keyword">private</span> String address;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line">EmpRepository empRepository;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testAddEmp</span><span class="params">()</span></span>&#123;</span><br><span class="line">  Emp emp = <span class="keyword">new</span> Emp();</span><br><span class="line">  emp.setId(UUID.randomUUID().toString());</span><br><span class="line">  emp.setName(<span class="string">&quot;张三丰&quot;</span>);</span><br><span class="line">  emp.setBir(<span class="keyword">new</span> Date());</span><br><span class="line">  emp.setAge(<span class="number">23</span>);</span><br><span class="line">  emp.setAddress(<span class="string">&quot;武当山学院&quot;</span>);</span><br><span class="line">  emp.setContent(<span class="string">&quot;武侠大师,我恁爹&quot;</span>);</span><br><span class="line">  empRepository.save(emp);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://twen-img-host.oss-cn-beijing.aliyuncs.com/img/elasticsearch/image-20210918111204649.png" alt="image-20210918111204649"></p>
<h2 id="检索"><a href="#检索" class="headerlink" title="检索"></a>检索</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">find</span><span class="params">()</span></span>&#123;</span><br><span class="line">  Optional&lt;Emp&gt; optional = empRepository.findById(<span class="string">&quot;5c74d37b-3327-4c92-9d01-fa120df47b9a&quot;</span>);</span><br><span class="line">  optional.ifPresent(System.out::println);</span><br><span class="line">  <span class="comment">//查询所有</span></span><br><span class="line">  Iterable&lt;Emp&gt; iterable = empRepository.findAll(Sort.by(Sort.Order.desc(<span class="string">&quot;name&quot;</span>)));</span><br><span class="line">  iterable.forEach(System.out::println);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://twen-img-host.oss-cn-beijing.aliyuncs.com/img/elasticsearch/image-20210918112021556.png" alt="image-20210918112021556"></p>
<blockquote>
<p>可以查询所有,查询并排序,分页查询</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line">public void findByPage()&#123;</span><br><span class="line">  empRepository.findAll(PageRequest.of(1, 20));&#x2F;&#x2F;从0开始</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="使用repository进行自定义查询"><a href="#使用repository进行自定义查询" class="headerlink" title="使用repository进行自定义查询"></a>使用repository进行自定义查询</h2><p><img src="https://twen-img-host.oss-cn-beijing.aliyuncs.com/img/elasticsearch/image-20210918132623184.png" alt="image-20210918132623184"></p>
<blockquote>
<p>在接口里面添加方法</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">EmpRepository</span> <span class="keyword">extends</span> <span class="title">ElasticsearchRepository</span>&lt;<span class="title">Emp</span>,<span class="title">String</span>&gt; </span>&#123;</span><br><span class="line">  <span class="comment">//根据姓名查询</span></span><br><span class="line">  <span class="function">List&lt;Emp&gt; <span class="title">findByName</span><span class="params">(String name)</span></span>;</span><br><span class="line">  <span class="comment">//根据年龄查询</span></span><br><span class="line">  <span class="function">List&lt;Emp&gt; <span class="title">findByAge</span><span class="params">(Integer age)</span></span>;</span><br><span class="line">  <span class="comment">//根据名字和年龄查询</span></span><br><span class="line">  <span class="function">List&lt;Emp&gt; <span class="title">findByNameAndAge</span><span class="params">(String name,Integer age)</span></span>;</span><br><span class="line">  <span class="comment">//根据名字或年龄查询</span></span><br><span class="line">  <span class="function">List&lt;Emp&gt; <span class="title">findByNameOrAge</span><span class="params">(String name,Integer age)</span></span>;</span><br><span class="line">  <span class="comment">//查找大于等于指定年龄的document</span></span><br><span class="line">  <span class="function">List&lt;Emp&gt; <span class="title">findByAgeGreaterThanEqual</span><span class="params">(Integer age)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="repository弊端"><a href="#repository弊端" class="headerlink" title="repository弊端"></a>repository弊端</h2><p><code>无法完成高亮查询.分页,指定字段</code></p>
<blockquote>
<p>高亮查询</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">highLightQuery</span><span class="params">()</span> <span class="keyword">throws</span> IOException, ParseException </span>&#123;</span><br><span class="line">  <span class="comment">//创建一个SearchRequest</span></span><br><span class="line">  SearchRequest searchRequest = <span class="keyword">new</span> SearchRequest(<span class="string">&quot;ems&quot;</span>);</span><br><span class="line">  SearchSourceBuilder searchSourceBuilder = <span class="keyword">new</span> SearchSourceBuilder()</span><br><span class="line">    .query(QueryBuilders.termQuery(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;张三&quot;</span>))</span><br><span class="line">    .sort(<span class="string">&quot;age&quot;</span>, SortOrder.DESC)</span><br><span class="line">    .from(<span class="number">0</span>)</span><br><span class="line">    .size(<span class="number">20</span>)</span><br><span class="line">    .highlighter(<span class="keyword">new</span> HighlightBuilder().field(<span class="string">&quot;*&quot;</span>).requireFieldMatch(<span class="keyword">false</span>).preTags(<span class="string">&quot;&lt;span style=&#x27;color:red&#x27;&gt;&quot;</span>).postTags(<span class="string">&quot;&lt;/span&gt;&quot;</span>));</span><br><span class="line">  searchRequest.source(searchSourceBuilder);</span><br><span class="line">  SearchResponse search = restHighLevelClient.search(searchRequest, RequestOptions.DEFAULT);</span><br><span class="line">  Emp emp = <span class="keyword">new</span> Emp();</span><br><span class="line">  <span class="keyword">for</span> (SearchHit hit : search.getHits().getHits()) &#123;</span><br><span class="line">    Map&lt;String, Object&gt; sourceAsMap = hit.getSourceAsMap();</span><br><span class="line">    emp.setId(sourceAsMap.get(<span class="string">&quot;id&quot;</span>).toString());</span><br><span class="line">    emp.setAddress(sourceAsMap.get(<span class="string">&quot;address&quot;</span>).toString());</span><br><span class="line">    emp.setContent(sourceAsMap.get(<span class="string">&quot;content&quot;</span>).toString());</span><br><span class="line">    emp.setAge(Integer.parseInt(sourceAsMap.get(<span class="string">&quot;age&quot;</span>).toString()));</span><br><span class="line">    <span class="comment">//高亮字段</span></span><br><span class="line">    Map&lt;String, HighlightField&gt; highlightFields = hit.getHighlightFields();</span><br><span class="line">    <span class="keyword">if</span>(highlightFields.containsKey(<span class="string">&quot;name&quot;</span>))&#123;</span><br><span class="line">      emp.setName(highlightFields.get(<span class="string">&quot;name&quot;</span>).fragments()[<span class="number">0</span>].toString());</span><br><span class="line">    &#125;</span><br><span class="line">    System.out.println(emp);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">twen</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://twen20010806.github.io/2021/09/20/elasticsearch/">https://twen20010806.github.io/2021/09/20/elasticsearch/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://twen20010806.github.io" target="_blank">_raio</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/elastcisearch/">elastcisearch</a></div><div class="post_share"><div class="social-share" data-image="https://twen-img-host.oss-cn-beijing.aliyuncs.com/img/elasticsearch/cover.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-full"><a href="/2021/08/16/nacos-config-sql/"><img class="prev-cover" src="/img/floor.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">nacos_config.sql</div></div></a></div></nav><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#ElasticSearch"><span class="toc-number">1.</span> <span class="toc-text">ElasticSearch</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Restful"><span class="toc-number">1.1.</span> <span class="toc-text">Restful</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%A8%E6%96%87%E6%A3%80%E7%B4%A2"><span class="toc-number">1.2.</span> <span class="toc-text">全文检索</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AFElasticSearch"><span class="toc-number">1.3.</span> <span class="toc-text">什么是ElasticSearch</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Elastic-Stack-%E6%A0%88"><span class="toc-number">1.4.</span> <span class="toc-text">Elastic Stack 栈</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ES%E7%9A%84%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-number">1.5.</span> <span class="toc-text">ES的应用场景</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ES%E7%9A%84%E6%9E%B6%E6%9E%84"><span class="toc-number">1.6.</span> <span class="toc-text">ES的架构</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#ElasticSearch%E5%AE%89%E8%A3%85"><span class="toc-number">2.</span> <span class="toc-text">ElasticSearch安装</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8Docker%E5%AE%89%E8%A3%85ES-6-8-0"><span class="toc-number">2.1.</span> <span class="toc-text">使用Docker安装ES 6.8.0</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%80%E5%90%AFES%E8%BF%9C%E7%A8%8B%E8%BF%9E%E6%8E%A5%E6%9D%83%E9%99%90"><span class="toc-number">2.2.</span> <span class="toc-text">开启ES远程连接权限</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Kibana%E5%AE%89%E8%A3%85"><span class="toc-number">2.3.</span> <span class="toc-text">Kibana安装</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#ElasticSearch%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5"><span class="toc-number">3.</span> <span class="toc-text">ElasticSearch基本概念</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8E%A5%E8%BF%91%E5%AE%9E%E6%97%B6-NRT-Near-Real-Time"><span class="toc-number">3.1.</span> <span class="toc-text">接近实时(NRT Near Real Time)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95-index"><span class="toc-number">3.2.</span> <span class="toc-text">索引(index)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%B1%BB%E5%9E%8B-type"><span class="toc-number">3.3.</span> <span class="toc-text">类型(type)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%98%A0%E5%B0%84-Mapping"><span class="toc-number">3.4.</span> <span class="toc-text">映射(Mapping)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%87%E6%A1%A3-documnt"><span class="toc-number">3.5.</span> <span class="toc-text">文档(documnt)</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Kibana%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C"><span class="toc-number">4.</span> <span class="toc-text">Kibana的基本操作</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95-index-%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C"><span class="toc-number">4.1.</span> <span class="toc-text">索引(index)的基本操作</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#ES%E4%B8%AD%E9%AB%98%E7%BA%A7%E6%90%9C%E7%B4%A2-Query"><span class="toc-number">5.</span> <span class="toc-text">ES中高级搜索(Query)</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A3%80%E7%B4%A2%E6%96%B9%E5%BC%8F"><span class="toc-number">5.1.</span> <span class="toc-text">检索方式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8EQueryString%E6%96%B9%E5%BC%8F%E7%9A%84%E6%A3%80%E7%B4%A2"><span class="toc-number">5.2.</span> <span class="toc-text">基于QueryString方式的检索</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8EQueryDSL%E6%96%B9%E5%BC%8F%E7%9A%84%E6%A3%80%E7%B4%A2"><span class="toc-number">5.3.</span> <span class="toc-text">基于QueryDSL方式的检索</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90"><span class="toc-number">5.4.</span> <span class="toc-text">索引底层原理分析</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#IK%E5%88%86%E8%AF%8D%E5%99%A8"><span class="toc-number">6.</span> <span class="toc-text">IK分词器</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E8%A3%85"><span class="toc-number">6.1.</span> <span class="toc-text">安装</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95"><span class="toc-number">6.2.</span> <span class="toc-text">测试</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#JAVA%E6%93%8D%E4%BD%9CES"><span class="toc-number">7.</span> <span class="toc-text">JAVA操作ES</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%95%E5%85%A5maven%E4%BE%9D%E8%B5%96"><span class="toc-number">7.1.</span> <span class="toc-text">引入maven依赖</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#springboot-%E9%9B%86%E6%88%90-ES"><span class="toc-number">8.</span> <span class="toc-text">springboot 集成 ES</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%B0%E7%89%88%E4%BD%BF%E7%94%A8RestHighLevelClient"><span class="toc-number">8.1.</span> <span class="toc-text">新版使用RestHighLevelClient</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E7%89%B9%E6%80%A7%E7%9A%84%E6%93%8D%E4%BD%9CES%E7%9A%84api"><span class="toc-number">8.2.</span> <span class="toc-text">面向对象特性的操作ES的api</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%A0%E9%99%A4"><span class="toc-number">8.3.</span> <span class="toc-text">删除</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9B%E5%BB%BAentity"><span class="toc-number">8.4.</span> <span class="toc-text">创建entity</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A3%80%E7%B4%A2"><span class="toc-number">8.5.</span> <span class="toc-text">检索</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8repository%E8%BF%9B%E8%A1%8C%E8%87%AA%E5%AE%9A%E4%B9%89%E6%9F%A5%E8%AF%A2"><span class="toc-number">8.6.</span> <span class="toc-text">使用repository进行自定义查询</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#repository%E5%BC%8A%E7%AB%AF"><span class="toc-number">8.7.</span> <span class="toc-text">repository弊端</span></a></li></ol></li></ol></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2021 By twen</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="chat_btn" type="button" title="rightside.chat_btn"><i class="fas fa-sms"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div></div><hr/><div id="local-search-results"></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>function loadValine () {
  function initValine () {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: '',
      appKey: '',
      placeholder: 'Please leave your footprints',
      avatar: 'monsterid',
      meta: 'nick,mail,link'.split(','),
      pageSize: '10',
      lang: 'en',
      recordIP: false,
      serverURLs: '',
      emojiCDN: '',
      emojiMaps: "",
      enableQQ: false,
      path: window.location.pathname,
      requiredFields: ["nick,mail"],
      visitor: false
    }, null))
  }

  if (typeof Valine === 'function') initValine() 
  else getScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js').then(initValine)
}

if ('Valine' === 'Valine' || !true) {
  if (true) btf.loadComment(document.getElementById('vcomment'),loadValine)
  else setTimeout(loadValine, 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script></div><script src="\js\sakura.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>